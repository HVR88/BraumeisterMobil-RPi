{% extends "base.html" %}
{% block title %}Home{% endblock %}
{% block head %}

{{ super() }}
{% endblock %}
{% block content %}
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
    <title>BMPi</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
    <table class="screen">
        <tbody>
            <tr>
                <td id="ipaddr" colspan="2" height="40"height="10" >ip address</td><td height="10" >P/H</td>
            </tr>
            <tr>
                <td colspan="2" >BMPi</td><td colspan="2" >BMPi</td>
            </tr>
            <tr>
                <td colspan="2">Temp</td><td id="temp" colspan="2">50C</td>
            </tr>
            <tfoot>
            <tr>
                <form method="post" action="/ui">
                    <td><button type="submit" name="key" value="/bm.txt?k=1">1</button></td>
                    <td><button type="submit" name="key" value="/bm.txt?k=2">2</button></td>
                    <td><button type="submit" name="key" value="/bm.txt?k=3">3</button></td>
                    <td><button type="submit" name="key" value="/bm.txt?k=4">4</button></td>
                    <td><button type="submit" name="key" value="/bm.html">bm.html</button></td>
                    <td><button type="submit" name="key" value="/bm.txt">bm.txt</button></td>
                    <td><button type="submit" name="key" value="/index.html">index.html</button></td>
                    <td><button type="submit" name="key" value="/start.bmp">start.bmp</button></td>
                    <td><button type="submit" name="key" value="/rz.txt">rz.txt</button></td>
                    <td><button type="submit" name="key" value="/">/</button></td>

                </form>
            </tr>
            </tfoot>
        </tbody>
    </table>
        <script>
            var tempContainer = document.getElementById("temp");
            var ipContainer = document.getElementById("ipaddr");

            const eventSource = new EventSource("/stream");
            eventSource.onmessage = function(e) {
                console.log(e.data)
                const obj = JSON.parse(e.data);
                if(typeof obj.target_temp !== 'undefined')
                    tempContainer.innerHTML = obj.target_temp + '<br>';

                if(typeof obj.ipaddr !== 'undefined')
                    ipContainer.innerHTML = obj.ipaddr + '<br>';
            };
            eventSource.onerror = function(err) {
                console.error('EventSource failed:', err);
            };    
        </script>

{% endblock %}
